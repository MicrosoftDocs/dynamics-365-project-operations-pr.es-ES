---
title: Configurar la creación automática de facturas
description: Este tema proporciona información sobre la definición y configuración de la creación automática de facturas proforma.
author: rumant
ms.date: 04/05/2021
ms.topic: article
ms.reviewer: kfend
ms.author: rumant
ms.openlocfilehash: 2d212f2279b28d900e75d45386e343f95b8e825e
ms.sourcegitcommit: 40f68387f594180af64a5e5c748b6efa188bd300
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 05/10/2021
ms.locfileid: "6004192"
---
# <a name="set-up-automatic-invoice-creation"></a><span data-ttu-id="fb242-103">Configurar la creación automática de facturas</span><span class="sxs-lookup"><span data-stu-id="fb242-103">Set up automatic invoice creation</span></span> 
 
<span data-ttu-id="fb242-104">_**Se aplica a:** Implementación lite: acuerdo para factura proforma, Project Operations para escenarios basados en recursos/no mantenidos_</span><span class="sxs-lookup"><span data-stu-id="fb242-104">_**Applies To:** Lite deployment - deal to proforma invoicing, Project Operations for resource/non-stocked based scenarios_</span></span>

<span data-ttu-id="fb242-105">Puede configurar la creación automática de facturas en Dynamics 365 Project Operations.</span><span class="sxs-lookup"><span data-stu-id="fb242-105">You can configure automatic invoice creation in Dynamics 365 Project Operations.</span></span> <span data-ttu-id="fb242-106">El sistema crea un borrador de factura proforma basado en la programación de facturas de cada contrato de proyecto y línea de contrato.</span><span class="sxs-lookup"><span data-stu-id="fb242-106">The system creates a draft proforma invoice based on the invoice schedule for each project contract and contract line.</span></span> <span data-ttu-id="fb242-107">Las programaciones de facturas se configuran en el nivel de línea de contrato.</span><span class="sxs-lookup"><span data-stu-id="fb242-107">Invoice schedules are configured at the contract line level.</span></span> <span data-ttu-id="fb242-108">Cada línea de un contrato puede tener una programación de facturas distinta, o se puede incluir la misma programación de facturas en cada línea del contrato.</span><span class="sxs-lookup"><span data-stu-id="fb242-108">Each line on a contract can have a distinct invoice schedule, or the same invoice schedule can be included on every line of the contract.</span></span>

<span data-ttu-id="fb242-109">Cuando crea una factura, el sistema siempre crea al menos una factura por contrato de proyecto.</span><span class="sxs-lookup"><span data-stu-id="fb242-109">When you create an invoice, the system always creates at least one invoice per project contract.</span></span> <span data-ttu-id="fb242-110">En algunos casos, puede haber varias facturas creadas.</span><span class="sxs-lookup"><span data-stu-id="fb242-110">In some cases, there may be multiple invoices created.</span></span> <span data-ttu-id="fb242-111">Por ejemplo, si el contrato tiene varios clientes, se creará el mismo número de facturas que el número de clientes que tienen transacciones facturables para facturar en ese contrato de proyecto.</span><span class="sxs-lookup"><span data-stu-id="fb242-111">For example, if the contract has multiple customers, the same number of invoices will be created as the number of customers that have billable transactions to invoice on that project contract.</span></span>

## <a name="understand-how-transactions-are-included-on-an-invoice"></a><span data-ttu-id="fb242-112">Comprender cómo se incluyen las transacciones en una factura</span><span class="sxs-lookup"><span data-stu-id="fb242-112">Understand how transactions are included on an invoice</span></span> 

<span data-ttu-id="fb242-113">A veces, cada línea de contrato basada en el proyecto especifica un cronograma de facturación por separado.</span><span class="sxs-lookup"><span data-stu-id="fb242-113">Sometimes, each project-based contract line specifies a separate invoice schedule.</span></span> <span data-ttu-id="fb242-114">Por ejemplo, los servicios de implementación para el contrato Adatum tienen las siguientes líneas de contrato:</span><span class="sxs-lookup"><span data-stu-id="fb242-114">For example, implementation services for the Adatum contract have the following contract lines:</span></span>

- <span data-ttu-id="fb242-115">Prototipo de trabajo a precio fijo con dos hitos creados manualmente.</span><span class="sxs-lookup"><span data-stu-id="fb242-115">Prototype work that is a fixed price with two manually created milestones.</span></span>
- <span data-ttu-id="fb242-116">Trabajos de implementación que incluyen horas y se facturarán quincenalmente los lunes.</span><span class="sxs-lookup"><span data-stu-id="fb242-116">Implementation work that includes Time and will be billed bi-weekly on Mondays.</span></span>
- <span data-ttu-id="fb242-117">Gastos incurridos que deben facturarse mensualmente el primer lunes de cada mes.</span><span class="sxs-lookup"><span data-stu-id="fb242-117">Expenses incurred that need to be billed monthly on the first Monday of each month.</span></span>

<span data-ttu-id="fb242-118">Los programas de facturación definidos en cada una de estas dos líneas de pedido se parecen a la siguiente tabla:</span><span class="sxs-lookup"><span data-stu-id="fb242-118">Invoice schedules defined on each of these two line items look like the following table:</span></span>

| <span data-ttu-id="fb242-119">Línea de contrato</span><span class="sxs-lookup"><span data-stu-id="fb242-119">Contract line</span></span> | <span data-ttu-id="fb242-120">Fecha de ejecución de la factura</span><span class="sxs-lookup"><span data-stu-id="fb242-120">Invoice run date</span></span> | <span data-ttu-id="fb242-121">Fecha límite de la transacción</span><span class="sxs-lookup"><span data-stu-id="fb242-121">Transaction cut-off date</span></span> | <span data-ttu-id="fb242-122">Fecha de hito</span><span class="sxs-lookup"><span data-stu-id="fb242-122">Milestone date</span></span> | <span data-ttu-id="fb242-123">Importe del hito</span><span class="sxs-lookup"><span data-stu-id="fb242-123">Milestone amount</span></span> |
| --- | --- | --- | --- | --- |
| <span data-ttu-id="fb242-124">Prototipo de trabajo</span><span class="sxs-lookup"><span data-stu-id="fb242-124">Prototype work</span></span> | <span data-ttu-id="fb242-125">Lunes 5 de octubre</span><span class="sxs-lookup"><span data-stu-id="fb242-125">October 5, Monday</span></span> | - | <span data-ttu-id="fb242-126">Lunes 5 de octubre</span><span class="sxs-lookup"><span data-stu-id="fb242-126">October 5, Monday</span></span> | <span data-ttu-id="fb242-127">5000 USD</span><span class="sxs-lookup"><span data-stu-id="fb242-127">5000 USD</span></span> |
| - | <span data-ttu-id="fb242-128">Martes 3 de diciembre</span><span class="sxs-lookup"><span data-stu-id="fb242-128">November 3, Tuesday</span></span> | - | <span data-ttu-id="fb242-129">Martes 3 de diciembre</span><span class="sxs-lookup"><span data-stu-id="fb242-129">November 3, Tuesday</span></span> | <span data-ttu-id="fb242-130">12 000 USD</span><span class="sxs-lookup"><span data-stu-id="fb242-130">12,000 USD</span></span> |
| <span data-ttu-id="fb242-131">Trabajo de implementación</span><span class="sxs-lookup"><span data-stu-id="fb242-131">Implementation work</span></span> | <span data-ttu-id="fb242-132">Lunes 5 de octubre</span><span class="sxs-lookup"><span data-stu-id="fb242-132">October 5, Monday</span></span> | <span data-ttu-id="fb242-133">Domingo 4 de octubre</span><span class="sxs-lookup"><span data-stu-id="fb242-133">October 4, Sunday</span></span> | - | - |
| - | <span data-ttu-id="fb242-134">Lunes 19 de octubre</span><span class="sxs-lookup"><span data-stu-id="fb242-134">October 19, Monday</span></span> | <span data-ttu-id="fb242-135">Domingo 18 de octubre</span><span class="sxs-lookup"><span data-stu-id="fb242-135">October 18, Sunday</span></span> | - | - |
| - | <span data-ttu-id="fb242-136">Lunes 2 de noviembre</span><span class="sxs-lookup"><span data-stu-id="fb242-136">November 2, Monday</span></span> | <span data-ttu-id="fb242-137">Domingo 1 de noviembre</span><span class="sxs-lookup"><span data-stu-id="fb242-137">November 1, Sunday</span></span> | - | - |
| - | <span data-ttu-id="fb242-138">Lunes 16 de noviembre</span><span class="sxs-lookup"><span data-stu-id="fb242-138">November 16, Monday</span></span> | <span data-ttu-id="fb242-139">Domingo 15 de noviembre</span><span class="sxs-lookup"><span data-stu-id="fb242-139">November 15, Sunday</span></span> | - | - |
| <span data-ttu-id="fb242-140">Gastos incurridos</span><span class="sxs-lookup"><span data-stu-id="fb242-140">Expenses incurred</span></span> | <span data-ttu-id="fb242-141">Lunes 5 de octubre</span><span class="sxs-lookup"><span data-stu-id="fb242-141">October 5, Monday</span></span> | <span data-ttu-id="fb242-142">Domingo 4 de octubre</span><span class="sxs-lookup"><span data-stu-id="fb242-142">October 4, Sunday</span></span> | - | - |
| - | <span data-ttu-id="fb242-143">Lunes 2 de noviembre</span><span class="sxs-lookup"><span data-stu-id="fb242-143">November 2, Monday</span></span> | <span data-ttu-id="fb242-144">Domingo 1 de noviembre</span><span class="sxs-lookup"><span data-stu-id="fb242-144">November 1, Sunday</span></span> | - | - |

<span data-ttu-id="fb242-145">En este ejemplo, cuando la facturación automática se ejecuta en:</span><span class="sxs-lookup"><span data-stu-id="fb242-145">In this example when the automatic invoicing runs on:</span></span>

- <span data-ttu-id="fb242-146">**4 de octubre o cualquier fecha anterior**: no se genera ninguna factura para este contrato porque la tabla de **Programación de facturas** para cada una de estas líneas de contrato no indica el 4 de octubre, domingo, como fecha de ejecución de la factura.</span><span class="sxs-lookup"><span data-stu-id="fb242-146">**October 4 or any date before**: No invoice is generated for this contract because the **Invoice Schedule** table for each of these contract lines doesn't call out October 4, Sunday as an invoice run date.</span></span>
- <span data-ttu-id="fb242-147">**5 de octubre lunes**: se genera una factura para:</span><span class="sxs-lookup"><span data-stu-id="fb242-147">**October 5 Monday**: One invoice is generated for:</span></span>

    - <span data-ttu-id="fb242-148">Trabajo de prototipo que incluye el hito, si está marcado como **Listo para facturar**.</span><span class="sxs-lookup"><span data-stu-id="fb242-148">Prototype work that includes the milestone, if it is marked as **Ready to Invoice**.</span></span>
    - <span data-ttu-id="fb242-149">Trabajo de implementación que incluye todas las transacciones de horas creadas antes de la fecha de cierre de la transacción del 4 de octubre, domingo, que está marcada como **Listo para facturar**.</span><span class="sxs-lookup"><span data-stu-id="fb242-149">Implementation work that includes all Time transactions created before the transaction cut-off date of October 4, Sunday, that is marked as **Ready to Invoice**.</span></span>
    - <span data-ttu-id="fb242-150">Gastos incurridos que incluye todas las transacciones de gastos creadas antes de la fecha de cierre de la transacción del 4 de octubre, domingo, que está marcada como **Listo para facturar**.</span><span class="sxs-lookup"><span data-stu-id="fb242-150">Expense incurred that includes all Expense transactions created before the transaction cut-off date of October 4, Sunday, that is marked as **Ready to Invoice**.</span></span>
  
- <span data-ttu-id="fb242-151">**6 de octubre o cualquier fecha anterior al 19 de octubre**: no se genera ninguna factura para este contrato ya que la tabla de **Programación de facturas** para cada una de estas líneas de contrato no indica el 6 de octubre o cualquier fecha previa al 19 de octubre, como fecha de ejecución de la factura.</span><span class="sxs-lookup"><span data-stu-id="fb242-151">**On October 6 or any date before October 19**: No invoice is generated for this contract since the **Invoice Schedule** table for each of these contract lines does not call out October 6 or any date before October 19 as an invoice run date.</span></span>
- <span data-ttu-id="fb242-152">**19 de ocutbre, lunes:** se genera una factura para implementación que incluye todas las transacciones de horas creadas antes de la fecha de cierre de la transacción del 18 de octubre, domingo, que está marcada como **Listo para facturar**.</span><span class="sxs-lookup"><span data-stu-id="fb242-152">**October 19, Monday**: One invoice is generated for implementation work that includes all Time transactions created before the transaction cut-off date of October 18, Sunday, that is marked as **Ready to Invoice**.</span></span>
- <span data-ttu-id="fb242-153">**2 de noviembre lunes**: se genera una factura para:</span><span class="sxs-lookup"><span data-stu-id="fb242-153">**November 2 Monday**: One invoice is generated for:</span></span>

    - <span data-ttu-id="fb242-154">Trabajo de implementación que incluye todas las transacciones de horas creadas antes de la fecha de cierre de la transacción del 1 de noviembre, domingo, que está marcada como **Listo para facturar**.</span><span class="sxs-lookup"><span data-stu-id="fb242-154">Implementation work that includes all Time transactions created before the transaction cut-off date of November 1, Sunday, that is marked as **Ready to Invoice**.</span></span>
    - <span data-ttu-id="fb242-155">Gastos incurridos que incluye todas las transacciones de gastos creadas antes de la fecha de cierre de la transacción del 1 de noviembre, domingo, que está marcada como **Listo para facturar**.</span><span class="sxs-lookup"><span data-stu-id="fb242-155">Expense incurred that includes all Expense transactions created before the transaction cut-off date of November 1, Sunday, that is marked as **Ready to Invoice**.</span></span>

- <span data-ttu-id="fb242-156">**martes 3 de noviembre**: se genera una factura para el trabajo de prototipo que incluye el hito de 12 000 USD, si está marcado como **Listo para facturar**.</span><span class="sxs-lookup"><span data-stu-id="fb242-156">**November 3, Tuesday**: One invoice is generated for prototype work that includes the milestone for 12000 USD, if it is marked as **Ready to Invoice**.</span></span>

## <a name="configure-automatic-invoicing"></a><span data-ttu-id="fb242-157">Configurar facturación automática</span><span class="sxs-lookup"><span data-stu-id="fb242-157">Configure automatic invoicing</span></span>

<span data-ttu-id="fb242-158">Complete estos pasos para configurar la ejecución automática de facturas.</span><span class="sxs-lookup"><span data-stu-id="fb242-158">Complete the following steps to configure an automated invoice run.</span></span>

1. <span data-ttu-id="fb242-159">En **Operaciones de proyecto**, vaya a **Configuración** > **Configuración de facturas recurrentes**.</span><span class="sxs-lookup"><span data-stu-id="fb242-159">In **Project Operations**, go to **Settings** > **Recurring Invoice Setup**.</span></span>
2. <span data-ttu-id="fb242-160">Cree un trabajo por lotes y asígnele el nombre **Creación de facturas de Project Operations**.</span><span class="sxs-lookup"><span data-stu-id="fb242-160">Create a batch job, and name it **rPoject Operations Create Invoices**.</span></span> <span data-ttu-id="fb242-161">El nombre del trabajo por lotes debe incluir las palabras "creación de facturas".</span><span class="sxs-lookup"><span data-stu-id="fb242-161">The name of the batch job must include the words, "create invoices".</span></span>
3. <span data-ttu-id="fb242-162">En el campo **Tipo de trabajo**, seleccione **Ninguno**.</span><span class="sxs-lookup"><span data-stu-id="fb242-162">In the **Job Type** field, select **None**.</span></span> <span data-ttu-id="fb242-163">De forma predeterminada, laos campos **Frecuencia diaria** y **Está activo** están configuradas con el valor **Sí**.</span><span class="sxs-lookup"><span data-stu-id="fb242-163">By default, the **Frequency Daily** and **Is Active** fields are set to **Yes**.</span></span>
4. <span data-ttu-id="fb242-164">Seleccione **Ejecutar flujo de trabajo**.</span><span class="sxs-lookup"><span data-stu-id="fb242-164">Select **Run Workflow**.</span></span> <span data-ttu-id="fb242-165">En el cuadro de diálogo **Buscar registro**, aparecerán tres flujos de trabajo:</span><span class="sxs-lookup"><span data-stu-id="fb242-165">In the **Look Up Record** dialog box, you will see three workflows:</span></span>

- <span data-ttu-id="fb242-166">ProcessRunCaller</span><span class="sxs-lookup"><span data-stu-id="fb242-166">ProcessRunCaller</span></span>
- <span data-ttu-id="fb242-167">ProcessRunner</span><span class="sxs-lookup"><span data-stu-id="fb242-167">ProcessRunner</span></span>
- <span data-ttu-id="fb242-168">UpdateRoleUtilization</span><span class="sxs-lookup"><span data-stu-id="fb242-168">UpdateRoleUtilization</span></span>

5. <span data-ttu-id="fb242-169">Seleccione **ProcessRunCaller** y luego elija **Agregar**.</span><span class="sxs-lookup"><span data-stu-id="fb242-169">Select **ProcessRunCaller**, and then select **Add**.</span></span>
6. <span data-ttu-id="fb242-170">En el siguiente cuadro de diálogo, seleccione **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="fb242-170">In the next dialog box, select **OK**.</span></span> <span data-ttu-id="fb242-171">Al flujo de trabajo **Suspensión** le sigue el flujo de trabajo **Proceso**.</span><span class="sxs-lookup"><span data-stu-id="fb242-171">A **Sleep** workflow is followed by a **Process** workflow.</span></span> 

> [!NOTE]
> <span data-ttu-id="fb242-172">También puede seleccionar **ProcessRunner** en el paso 5.</span><span class="sxs-lookup"><span data-stu-id="fb242-172">You can also select **ProcessRunner** in step 5.</span></span> <span data-ttu-id="fb242-173">A continuación, cuando se selecciona **Aceptar**, el flujo de trabajo **Proceso** va seguido del flujo de trabajo **Reposo**.</span><span class="sxs-lookup"><span data-stu-id="fb242-173">Then, when you select **OK**, a **Process** workflow is followed by a **Sleep** workflow.</span></span>

<span data-ttu-id="fb242-174">Los flujos de trabajo **ProcessRunCaller** y **ProcessRunner** crean facturas.</span><span class="sxs-lookup"><span data-stu-id="fb242-174">The **ProcessRunCaller** and **ProcessRunner** workflows create invoices.</span></span> <span data-ttu-id="fb242-175">**ProcessRunCaller** llama a **ProcessRunner**.</span><span class="sxs-lookup"><span data-stu-id="fb242-175">**ProcessRunCaller** calls **ProcessRunner**.</span></span> <span data-ttu-id="fb242-176">**ProcessRunner** es el flujo de trabajo que crea realmente las facturas.</span><span class="sxs-lookup"><span data-stu-id="fb242-176">**ProcessRunner** is the workflow that actually creates the invoices.</span></span> <span data-ttu-id="fb242-177">El flujo de trabajo pasa por todas las líneas de contrato para las que se deben crear facturas y crea las facturas para dichas líneas.</span><span class="sxs-lookup"><span data-stu-id="fb242-177">The workflow goes through all the contract lines that invoices must be created for, and creates invoices for those lines.</span></span> <span data-ttu-id="fb242-178">Para determinar las líneas de contrato para las que se deben crear facturas, el trabajo busca fechas de ejecución de facturas para las líneas de contrato.</span><span class="sxs-lookup"><span data-stu-id="fb242-178">To determine the contract lines that invoices must be created for, the job looks at invoice run dates for the contract lines.</span></span> <span data-ttu-id="fb242-179">Si detecta líneas de contrato que pertenecen a un mismo contrato con la misma fecha de ejecución de factura, las transacciones se combinarán en una factura con dos líneas de factura.</span><span class="sxs-lookup"><span data-stu-id="fb242-179">If contract lines that belong to one contract have the same invoice run date, the transactions are combined into one invoice that has two invoice lines.</span></span> <span data-ttu-id="fb242-180">Si no hay transacciones para crear facturas, el trabajo omite la creación de una factura.</span><span class="sxs-lookup"><span data-stu-id="fb242-180">If there are no transactions to create invoices for, the job skips creating an invoice.</span></span>

<span data-ttu-id="fb242-181">Cuando finaliza la ejecución de **ProcessRunner**, se llama al flujo de trabajo **ProcessRunCaller**, que proporciona la hora de finalización y después se cierra.</span><span class="sxs-lookup"><span data-stu-id="fb242-181">After **ProcessRunner** has finished running, it calls **ProcessRunCaller**, provides the end time, and is closed.</span></span> <span data-ttu-id="fb242-182">A continuación, **ProcessRunCaller** pone en marcha un temporizador que se ejecuta durante 24 horas desde la hora de finalización especificada.</span><span class="sxs-lookup"><span data-stu-id="fb242-182">**ProcessRunCaller** then starts a timer that runs for 24-hours from the specified end time.</span></span> <span data-ttu-id="fb242-183">Cuando se agota el tiempo del temporizador, el flujo de trabajo **ProcessRunCaller** se cierra.</span><span class="sxs-lookup"><span data-stu-id="fb242-183">At the end of the timer, **ProcessRunCaller** is closed.</span></span>

<span data-ttu-id="fb242-184">El trabajo de proceso por lotes de creación de facturas es periódico.</span><span class="sxs-lookup"><span data-stu-id="fb242-184">The batch process job for creating invoices is a recurrent job.</span></span> <span data-ttu-id="fb242-185">Si este proceso por lotes se ejecuta muchas veces, se crean varias instancias del trabajo y se generan errores.</span><span class="sxs-lookup"><span data-stu-id="fb242-185">If this batch process is run many times, multiple instances of the job are created and causes errors.</span></span> <span data-ttu-id="fb242-186">Por lo tanto, debe iniciar el proceso por lotes solo una vez y después reiniciarlo solo si se detiene su ejecución.</span><span class="sxs-lookup"><span data-stu-id="fb242-186">Therefore, you should start the batch process only one time, and then restart only if it stops running.</span></span>

> [!NOTE]
> <span data-ttu-id="fb242-187">La facturación por lotes en Project Operations solo se ejecuta para las líneas de contrato del proyecto que se configuran mediante programas de facturación.</span><span class="sxs-lookup"><span data-stu-id="fb242-187">Batch invoicing in Project Operations only runs for project contract lines that are configured by invoice schedules.</span></span> <span data-ttu-id="fb242-188">Una línea de contrato con un método de facturación de precio fijo debe tener hitos configurados.</span><span class="sxs-lookup"><span data-stu-id="fb242-188">A contract line with a fixed price billing method must have milestones configured.</span></span> <span data-ttu-id="fb242-189">Una línea de contrato de proyecto con un método de facturación de tiempo y material necesitará una programación de facturación basada en fecha.</span><span class="sxs-lookup"><span data-stu-id="fb242-189">A project contract line with a time and material billing method will need a date-based invoice schedule set up.</span></span>


[!INCLUDE[footer-include](../../includes/footer-banner.md)]
